@page
@model CheckInAndOutModel
@{
    ViewData["Title"] = "Check In & Out";
    //ViewData["TrxTypes"] = ("Credit", "Debit", "Spoil");
    //var photoPath = "~/images/" + (Model.ItemTrx.photoUrl ?? "noimage.jpg");
    //  var photoPath = "~/images/noimage.jpg";
    var photoPath = "~/images/TrackMagic-ItemNbr-Seq.jpg";
}

<form method="post" class="mt-3" enctype="multipart/form-data">

    <div class="text-center">
        <h1 class="display-4">Check In & Out</h1>
        <!--<p> Check this ItemTrx in or out </p>-->
    </div>

    <div asp-validation-summary="All" class="text-danger"></div>

    <input hidden asp-for="@Model.ItemTrx.staffID" />
    <input hidden asp-for="@photoPath" />


    <div class="form-group row">
        <label asp-for="ItemTrx.ItemTrxType" class="col-sm-2 col-form-label"></label>
        <div class="col-sm-10">
            <select asp-for="ItemTrx.ItemTrxType" class="custom-select mr-sm-2" asp-items="Html.GetEnumSelectList<eItemTrxType>()">
                <option value="">Please select (example)</option>
            </select>
            <span asp-validation-for="ItemTrx.ItemTrxType" class="text-danger"></span>
        </div>
    </div>

    @{string _vendorID = Model.ItemTrx.vendorID; }  <!--reference-->
    <div class="form-group row">
        @Html.LabelFor(x => Model.ItemTrx.vendorID, htmlAttributes: new { @class = "col-sm-2 col-form-label" })
        <div class="col-sm-10">
            @Html.DropDownListFor(x => Model.ItemTrx.vendorID, new SelectList(Model.GetVendorDropdownList(), "Value", "Text"), htmlAttributes: new { @class = "form-control", id = "Vendor" })
            @Html.ValidationMessageFor(x => x.ItemTrx.vendorID, "", new { @class = "text-danger" })
            <span asp-validation-for="ItemTrx.vendorID" class="text-danger"></span>
        </div>
    </div>


    @{string _itemTitle = Model.itemRepository.GetItemWith(Model.ItemTrx.itemID).title; }  <!--reference-->


    <div class="form-group row">
        @Html.LabelFor(x => Model.ItemTrx.itemID, htmlAttributes: new { @class = "col-sm-2 col-form-label" })
        <div class="col-sm-10">
            @Html.DropDownListFor(x => Model.ItemTrx.itemID, new SelectList(Model.GetItemDropdownList(_vendorID), "Value", "Text"), htmlAttributes: new { @class = "form-control", id = "Item" })
            @Html.ValidationMessageFor(x => x.ItemTrx.itemID, "", new { @class = "text-danger" })
            <span asp-validation-for="ItemTrx.itemID" class="text-danger"></span>
        </div>
    </div>

    <!--<div class="form-group row">

        <label asp-for=@_itemTitle class="col-sm-2 col-form-label"></label>
        <div class="col-sm-10">
            <input asp-for=@_itemTitle class="form-control" placeholder="Item Title" />
            <span asp-validation-for=@_itemTitle class="text-danger"></span>
        </div>
    </div>
        -->

    @{string _itemID = Model.ItemTrx.itemID; }  <!--reference-->
    <div class="form-group row">
        @Html.LabelFor(x => Model.ItemTrx.zoneID, htmlAttributes: new { @class = "col-sm-2 col-form-label" })
        <div class="col-sm-10">
            @Html.DropDownListFor(x => Model.ItemTrx.zoneID, new SelectList(Model.GetZoneDropdownList(_vendorID, _itemID), "Value", "Text"), htmlAttributes: new { @class = "form-control", id = "Zone" })
            @Html.ValidationMessageFor(x => x.ItemTrx.zoneID, "", new { @class = "text-danger" })
            <span asp-validation-for="ItemTrx.zoneID" class="text-danger"></span>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="ItemTrx.expDays" class="col-sm-2 col-form-label"></label>
        <div class="col-sm-10">
            <input asp-for="ItemTrx.expDays" class="form-control" placeholder="Exp. Days" />
            <span asp-validation-for="ItemTrx.expDays" class="text-danger"></span>
        </div>
    </div>

    <br />
    <br />
    <div class="mb-4">
        <!--<h6 class=" text-uppercase">Dashed</h6>-->
        <!-- Dashed divider -->
        <hr class="dashed">
    </div>

    <!--<div class="col-sm-2">
        <a asp-action="create" asp-controller="Item" class="btn btn-primary m-1">Capture Metrics</a>
        <button type="button" class="block">Block Button</button>
    </div>
        -->

    <form method="POST">
        <button type="submit" asp-route-data="foo" asp-page-handler="TakePicture">Capture Metrics</button>
    </form>
    <br />
    <br />

    <div class="form-group row">
        <label asp-for="ItemTrx.qty" class="col-sm-2 col-form-label"></label>
        <div class="col-sm-10">
            <input asp-for="ItemTrx.qty" class="form-control" placeholder="qty" />
            <!--<span asp-validation-for="ItemTrx.qty" class="text-danger"></span>-->
            <select asp-for="ItemTrx.qtyUnit" class="col-sm-2" asp-items="Html.GetEnumSelectList<eUnitType>()">
                <option value="">Please select</option>
            </select>
        </div>
    </div>

    <!--
    <div class="form-group row">
        <label asp-for="ItemTrx.qtyUnit" class="col-sm-2 col-form-label"></label>
        <div class="col-sm-10">
            <select asp-for="ItemTrx.qtyUnit" class="custom-select mr-sm-2" asp-items="Html.GetEnumSelectList<eUnitType>()">
                <option value="">Please select</option>
            </select>
            <span asp-validation-for="ItemTrx.qtyUnit" class="text-danger"></span>
        </div>
    </div>
        -->

    <div class="form-group row">
        <label asp-for="ItemTrx.upc" class="col-sm-2 col-form-label"></label>
        <div class="col-sm-10">
            <input asp-for="ItemTrx.upc" class="form-control" placeholder="UPC" />
            <span asp-validation-for="ItemTrx.upc" class="text-danger"></span>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="ItemTrx.weight" class="col-sm-2 col-form-label"></label>
        <div class="col-sm-10">
            <input asp-for="ItemTrx.weight" class="form-control" placeholder="Weight" />
            <span asp-validation-for="ItemTrx.weight" class="text-danger"></span>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="Photo" class="col-sm-2 col-form-label"></label>
        <div class="col-sm-10">
            <div class="custom-file">
                <input asp-for="Photo" class="custom-file-input form-control">
                <label class="custom-file-label"> Click to change photo</label>
            </div>
        </div>
    </div>

    <div class="form-group row">
        <label for="trxPhotoUpload">Example file input</label>
        <input type="file" class="form-control-file" id="logoupload">
    </div>

    <div class="form-group row col-sm-4 offset-4">
        <img class="imageThumbnail" src="@photoPath" asp-append-version="true" />
    </div>


    <div class="notification"></div>
</form>

@section Scripts
{
    <script>
$(document).ready(function () {
            let onchange = function () {
                let _this = $(this)[0];

                let frmdata = new FormData();
                frmdata.append('File', _this.files[0]);

                $("#trxPhotoUpload").change(function () {
                    readURL(this);
                });
                let onSuccess = function (model) {
                    console.log(model);
                    $('.notification').html("<div class='alert alert-success alert-dismissible fade show' role='alert'><strong>Logo&nbsp;</strong>Sucessfully uploaded!!!<button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div>");
                };

                $.ajax({
                    method: 'POST',
                    url: '/home/CheckInAndOut',
                    data: frmdata,
                    processData: false,
                    contentType: false,
                }).done(onSuccess);
            };

            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $('#displayimage').attr('src', e.target.result);
                    }

                    reader.readAsDataURL(input.files[0]);
                    @photoPath = input.files[0];
                }
            }

            $(document).on('change', 'input[type=file]', onchange);
        });</script>

}